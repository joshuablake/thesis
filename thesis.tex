\documentclass{cam-thesis}
\usepackage{setspace}
\onehalfspacing
\usepackage{graphicx}
\usepackage[utf8]{inputenc}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{floatpag}
\usepackage{bm}
\usepackage[algochapter]{algorithm2e}
\usepackage[nameinlink]{cleveref}
\usepackage[style=british]{csquotes}
\usepackage[T1]{fontenc}
\usepackage[unicode,psdextra]{hyperref}
\usepackage{textcomp} % provide symbols
\usepackage[disable]{todonotes}
\usepackage{xr}
\usepackage{pdflscape}
\usepackage{afterpage}
\usepackage{caption}
\usepackage{numprint}
% \usepackage{microtype}
\usepackage[UKenglish]{babel}
\usepackage{makecell}

% Diagrams
\usepackage{tikz}
\usetikzlibrary{arrows,positioning,automata,fit}

% Macros for common abbreviations to get the spacing right
% See: https://stackoverflow.com/questions/3282319/correct-way-to-define-macros-etc-ie-in-latex
\usepackage{xspace}
\makeatletter
\DeclareRobustCommand\onedot{\futurelet\@let@token\@onedot}
\def\@onedot{\ifx\@let@token.\else.\null\fi\xspace}
\def\eg{e.g\onedot} \def\Eg{\emph{E.g}\onedot}
\def\ie{i.e\onedot} \def\Ie{\emph{I.e}\onedot}
\def\cf{c.f\onedot} \def\Cf{\emph{C.f}\onedot}
\def\etc{etc\onedot} \def\vs{\emph{vs}\onedot}
\def\wrt{w.r.t\onedot} \def\dof{d.o.f\onedot}
\def\etal{et al\onedot}
\makeatother

% Generic maths commands
\def\reals{\mathbb{R}}
\def\nats{\mathbb{N}}
\def\sampSpace{\mathcal{X}}
\def\dist{\sim}
\DeclareMathOperator{\E}{\mathbb{E}}
\DeclareMathOperator{\V}{\mathbb{V}}
\DeclareMathOperator{\I}{\mathbb{I}}
\DeclareMathOperator{\prob}{\mathbb{P}}
\DeclareMathOperator{\p}{\pi}
\DeclareMathOperator{\var}{\mathbb{V}}
\DeclareMathOperator{\indicator}{\mathbb{I}}
\DeclareMathOperator{\cov}{Cov}
\DeclareMathOperator{\cor}{Cor}
\DeclareMathOperator{\logit}{logit}
\DeclareMathOperator{\Ber}{Bernoulli}
\DeclareMathOperator{\Bin}{Binomial}
\DeclareMathOperator{\Poi}{Poisson}
\DeclareMathOperator{\BetaDist}{Beta}
\DeclareMathOperator{\Exponential}{Exponential}
\DeclareMathOperator{\NBr}{NegBin}
\newcommand{\NBc}{\NBr_{c}}
\newcommand{\NBs}{\NBr_{s}}
\DeclareMathOperator{\BB}{BetaBin}
\DeclareMathOperator{\GamDist}{Gamma}
\DeclareMathOperator{\MN}{Multinomial}
\DeclareMathOperator{\N}{N}
\DeclareMathOperator{\MNorm}{N}
\DeclareMathOperator{\LN}{LN}
\DeclareMathOperator{\LKJ}{LKJ}
\DeclareMathOperator{\expit}{expit}
\newcommand\matr{\bm}
\newcommand\set{\mathcal}
\renewcommand{\vec}[1]{\bm{#1}}
\newcommand{\ssep}{:}
\DeclareMathOperator*{\argmax}{arg\,max}

% Thesis-specific maths commands
\newcommand{\dmax}{d_\text{max}}
\newcommand{\psens}{p_\text{sens}}
\newcommand{\ntot}{n_\text{tot}}
\newcommand{\ndet}{n_\text{d}}
\newcommand{\nnodet}{n_\text{u}}
\newcommand{\pnodet}{p_\text{u}}
\newcommand{\Npop}{N_\text{pop}}
\newcommand{\Ncis}{N_\text{CIS}}
\newcommand{\ncis}{\vec{n_\text{CIS}}}
\newcommand{\na}{\vec{n}_\text{a}}
\newcommand{\pcis}{\vec{p_\text{CIS}}}
\newcommand{\sched}{\mathbb{T}}
\newcommand{\nsched}{n_{\sched}}
\newcommand{\rate}{\mathfrak{R}}
\newcommand{\R}{\mathcal{R}_{0}}
\renewcommand{\Re}{\mathcal{R}_{e}(t)}
\newcommand{\Rc}{\mathcal{R}_{c}(t)}
\newcommand{\vlod}{v_\text{lod}}
\newcommand{\inform}{{_{\text{inform}}}}

\newcommand\citePersonalComms[1]{(#1, personal communication)}


\title{Estimating SARS-CoV-2 transmission in England from randomly sampled prevalence surveys}
\author{Joshua Benjamin Blake}
\date{\today}
\subjectline{MRC Biostatistics Unit}
\college{Jesus College}
\collegeshield{CollegeShields/jesus}
% \keywords{one two three}

%% Submission date :
\newcommand{\textdate}{March 2024}
\submissiondate{\textdate}

%% You can redefine the submission notice [optional]:
% For some reason the submission notice breaks if I just use \submissiondate
\submissionnotice{%
    This thesis is submitted for the degree of \\ \emph{Doctor of Philosophy} \\
    \textdate
}

% Only number labelled equations
% \forlistloop workaround due to incompatability with biblatex
% See: https://tex.stackexchange.com/questions/220268/biblatex-and-autonum-dont-work-together
\usepackage{etoolbox} % get the good meaning of \forlistloop
\let\etoolboxforlistloop\forlistloop % save the good meaning of \forlistloop
\usepackage{autonum}
\let\forlistloop\etoolboxforlistloop % restore the good meaning of \forlistloop
\makeatletter
\let\blx@noerroretextools\empty

% add contents and list of figures to PDF bookmarks
% See: https://tex.stackexchange.com/a/1821/95193
\pretocmd{\tableofcontents}{%
  \if@openright\cleardoublepage\else\clearpage\fi
  \pdfbookmark[0]{\contentsname}{toc}%
}{}{}%
\pretocmd{\listoffigures}{%
  \if@openright\cleardoublepage\else\clearpage\fi
  \pdfbookmark[0]{\listfigurename}{lof}%
}{}{}%
\makeatother

%% Bibliography
\usepackage[backend=biber,uniquename=init,sortcites=true,sorting=ynt,maxcitenames=2,style=apa,uniquelist=false]{biblatex}
\addbibresource{references.bib}
\addbibresource{refs-custom.bib}
% Display a linked DOI
\DeclareFieldFormat{doi}{%
  \mkbibacro{DOI}\addcolon\space
  \ifhyperref
    {\href{https://doi.org/#1}{\nolinkurl{#1}}}
    {\nolinkurl{#1}}%
}

\usepackage{subfiles} % Best loaded last in the preamble

%----Helper code for dealing with external references----
% (by cyberSingularity at http://tex.stackexchange.com/a/69832/226)

\usepackage{xr}
\makeatletter

\newcommand*{\addFileDependency}[1]{% argument=file name and extension
\typeout{(#1)}% latexmk will find this if $recorder=0
% however, in that case, it will ignore #1 if it is a .aux or 
% .pdf file etc and it exists! If it doesn't exist, it will appear 
% in the list of dependents regardless)
%
% Write the following if you want it to appear in \listfiles 
% --- although not really necessary and latexmk doesn't use this
%
\@addtofilelist{#1}
%
% latexmk will find this message if #1 doesn't exist (yet)
\IfFileExists{#1}{}{\typeout{No file #1.}}
}\makeatother

\newcommand*{\myexternaldocument}[1]{%
\externaldocument[E-]{\subfix{#1}}%
\addFileDependency{#1.aux}%
\addFileDependency{#1.tex}%
}
%------------End of helper code--------------

% put all the external documents here!
\myexternaldocument{thesis}

\abstract{%
    Surveillance is a crucial component to a pandemic response, informing public health and wider policy.
    Unfortunately, it is often subject to reporting and behavioural biases, reducing its robustness.
    % During the SARS-CoV-2 epidemic, the UK government funded two large-scale prevalence surveys with samples recruited randomly from the general population.
    % One of these, the CIS (Coronavirus Infection Survey), was a longitudinal survey run from April 2020 to March 2023.
    The CIS (Coronavirus Infection Survey) was a large-scale prevalence survey with participants recruited randomly from the general population, therefore avoiding these issues.

    In this thesis, I consider how to best use the CIS data for surveillance.
    %, can be used for surveillance to perform more robust inference.
    In particular, I consider the estimation of incidence (the number of new infections) and transmission (where infections are occurring) in England.

    This relies on knowledge of the duration of positivity (how long individuals test positive for).
    Therefore, I first consider how to estimate the distribution of this duration in the general population.
    I extend a pre-existing model of how an individual's viral load changes over time to estimate the duration of positivity.
    % I take two complementary approaches using different datasets.
    % This model is fitted to data from a longitudinal study of contacts of individuals with confirmed SARS-CoV-2 infection.
    % In \cref{ATACCC}, I extend a pre-existing model of how an individual's viral load changes over time to estimate the duration of positivity.
    % This model is fitted to data from the ATACCC (Assessment of Transmission and Contagiousness of COVID-19 in Contacts) study, a longitudinal study of viral load in contacts of individuals with confirmed SARS-CoV-2 infection.
    I use this detailed model to exploit frequent (daily) sampling of individuals in a cohort of contact traced individuals.
    However, the cohort was small and follow-up short meaning that the tail of the duration distribution is poorly estimated.

    % Therefore, in \cref{perf-test,imperf-test}, I combine the information from ATACCC with the larger CIS dataset.
    % I analyse the CIS in a survival analysis framework.
    Therefore, I combine the information with the larger and longer CIS dataset.
    The CIS data poses several challenges because it is double interval censored and some individuals in the cohort have infections that are never detected.
    I apply a survival analysis framework to analyse this data, which had previously only been in simpler settings.
    In addition, I develop novel methodology to incorporate false negatives into the framework.
    % The results showed that false negatives in the CIS data needed to be included in the model.
    % In \cref{imperf-test} I develop a novel methodology to do so.
    This results in an estimate of the full duration distribution in the general population, not previously available.

    Finally, I use this estimate to estimate the incidence and transmission of SARS-CoV-2 in England.
    I fully propagate the sampling error, accurately include the shape of the duration distribution, and estimate the quantities by age; previous work lacked at least one of these.
    Furthermore, I fit to only the CIS data, showing that such a survey is adequate to estimate these quantities.
    % without requiring an evidence synthesis approach previously used.
}

\acknowledgements{%
    \todo[inline]{Write acknowledgements}
}

\preface{%
    \todo[inline]{Write preface}
    \begin{itemize}
        \item Early version of this work used in ONS reports
        \item Chapters in JASA paper
        \item Chapter for PNAS (or similar) journal
    \end{itemize}
}

\setcounter{tocdepth}{2}

%% REMOVE THESE FOR FINAL VERSION WITHOUT TODOS
% \usepackage{geometry}
% \setlength{\marginparwidth}{3cm}
% \geometry{margin=3.8cm}

\begin{document}

\frontmatter{}

\listoffigures

\subfile{introduction}
\subfile{biology-data}
\subfile{incidence-prevalence}
\subfile{ATACCC}
\subfile{cis-perfect-testing}
\subfile{cis-imperfect-testing}
\subfile{transmission}

\subfile{conclusion}

\newrefcontext[sorting=nyt]
\printbibliography[heading=bibintoc]

\appendix

\subfile{distributions}
\subfile{MCMC-appendix}
\subfile{ATACCC-appendix-original-analysis}
\subfile{transmission-appendix-INLA}
\subfile{transmission-appendix-phase-type}
\subfile{transmission-appendix-plots}

\todo[inline]{
    Equation numbering hack
    \cref{perf-test:eq:piu}
    \cref{inc-prev:eq:forward-substitute}
    \cref{inc-prev:eq:EPt-matrix}
    \cref{inc-prev:eq:Smatrix}
}
\listoftodos

\end{document}